{% extends "base.html" %}
{% block title %}SKEIN - {{ folio.folio_id }}{% endblock %}

{% block content %}
<section>
    <p class="breadcrumb">
        <a href="/sites">Sites</a> /
        <a href="/sites/{{ folio.site_id }}">{{ folio.site_id }}</a> /
        {{ folio.folio_id }}
    </p>

    <h1><span class="type-marker {{ folio.type }}">{{ folio.type }}</span> {{ folio.folio_id }}</h1>

    <div class="folio-meta">
        <span>{{ folio.created_at.strftime('%B %d, %Y at %H:%M') if folio.created_at else 'Unknown date' }}</span>
        {% if folio.agent_id %}
        <span>by {{ folio.agent_id }}</span>
        {% endif %}
        <span class="status-{{ folio.status or 'open' }}">{{ folio.status or 'open' }}</span>
        {% if folio.assigned_to %}
        <span>assigned to {{ folio.assigned_to }}</span>
        {% endif %}
        {% if folio.target_agent %}
        <div>
            <span style="color: var(--text-secondary);">Target agent:</span>
            <span>{{ folio.target_agent }}</span>
        </div>
        {% endif %}
    </div>
</section>

<section>
    <div class="folio-content">{{ folio.content }}</div>

    {% for ref in cross_refs %}
    <label for="sn-{{ loop.index }}" class="margin-toggle sidenote-number"></label>
    <input type="checkbox" id="sn-{{ loop.index }}" class="margin-toggle"/>
    <span class="sidenote">
        <a href="/folios/{{ ref.folio_id }}">{{ ref.folio_id }}</a><br>
        {{ ref.content[:80] }}{% if ref.content|length > 80 %}...{% endif %}
    </span>
    {% endfor %}
</section>

{% if threads %}
<section>
    <h2>Thread History</h2>
    <ul class="item-list">
        {% for thread in threads %}
        <li>
            <span class="activity-time">{{ thread.created_at.strftime('%b %d %H:%M') if thread.created_at else '' }}</span>
            <strong>{{ thread.verb }}</strong>
            {% if thread.from_id != folio.folio_id %}
            from <a href="/folios/{{ thread.from_id }}">{{ thread.from_id }}</a>
            {% endif %}
            {% if thread.to_id != folio.folio_id %}
            to <a href="/folios/{{ thread.to_id }}">{{ thread.to_id }}</a>
            {% endif %}
            {% if thread.note %}
            <span class="item-meta">{{ thread.note }}</span>
            {% endif %}
        </li>
        {% endfor %}
    </ul>
</section>
{% endif %}
{% endblock %}
